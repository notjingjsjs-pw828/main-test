<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - BEN-BOT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-100 to-purple-100 min-h-screen">
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-gradient-to-b from-indigo-800 to-purple-900 text-white h-screen p-4 shadow-lg">
      <h2 class="text-2xl font-bold mb-6 text-center border-b pb-2">👑 Admin Panel</h2>
      <nav class="space-y-3">
        <button onclick="showView('coinsView', this)" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600 transition">💰 Add Coins</button>
        <button onclick="showView('botsView', this)" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600 transition">🤖 All Bots</button>
        <button onclick="showView('usersView', this)" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600 transition">👥 All Users</button>
        <button onclick="showView('filesView', this)" class="w-full text-left px-4 py-2 rounded hover:bg-indigo-600 transition">📁 Manage Files</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8">
      <!-- Add Coins View -->
      <section id="coinsView" class="hidden">
        <h2 class="text-2xl font-bold text-purple-700 mb-4">Add Coins to User</h2>
        <input id="coinUser" type="text" placeholder="Username" class="border border-purple-400 px-4 py-2 rounded mb-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-500" />
        <input id="coinAmount" type="number" placeholder="Amount" class="border border-purple-400 px-4 py-2 rounded mb-4 w-full focus:outline-none focus:ring-2 focus:ring-purple-500" />
        <button onclick="addCoins()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded shadow">➕ Add Coins</button>
      </section>

      <!-- All Bots View -->
      <section id="botsView" class="hidden">
        <h2 class="text-2xl font-bold text-purple-700 mb-4">All Bots</h2>
        <div id="botsList" class="space-y-4"></div>
      </section>

      <!-- All Users View -->
      <section id="usersView" class="hidden">
        <h2 class="text-2xl font-bold text-purple-700 mb-4">All Users</h2>
        <div id="usersList" class="space-y-4"></div>
      </section>

      <!-- Manage Files View -->
      <section id="filesView" class="hidden">
        <h2 class="text-2xl font-bold text-purple-700 mb-4">Manage Files</h2>
        <div id="filesList" class="space-y-4"></div>
      </section>
    </main>
  </div>

  <script>
    let currentActive;

    // Switch between views
    function showView(viewId, btn) {
      ['coinsView', 'botsView', 'usersView', 'filesView'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(viewId).classList.remove('hidden');

      if (currentActive) currentActive.classList.remove('bg-indigo-600');
      btn.classList.add('bg-indigo-600');
      currentActive = btn;

      if (viewId === 'botsView') loadBots();
      if (viewId === 'usersView') loadUsers();
      if (viewId === 'filesView') loadFiles();
    }

    // ✅ Add Coins to a user
    async function addCoins() {
      const username = document.getElementById('coinUser').value.trim();
      const amount = parseInt(document.getElementById('coinAmount').value.trim());

      if (!username || isNaN(amount)) {
        return Swal.fire("Error", "Please enter a valid username and amount", "error");
      }

      try {
        const res = await fetch('/api/admin/add-coins', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, amount })
        });
        const data = await res.json();
        Swal.fire(data.status ? "✅ Success" : "❌ Error", data.message, data.status ? "success" : "error");
      } catch (err) {
        Swal.fire("Error", "Failed to connect to server", "error");
      }
    }

    // ✅ Load all bots
    async function loadBots() {
      const res = await fetch('/api/admin/all-bots');
      const bots = await res.json();
      const container = document.getElementById('botsList');
      container.innerHTML = '';

      bots.forEach(bot => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow flex justify-between items-center';
        div.innerHTML = `
          <div>
            <strong class="text-indigo-700">${bot.name}</strong>
            <span class="text-sm text-gray-500">by ${bot.byUser}</span>
          </div>
          <button onclick="deleteBot('${bot.name}')" class="text-red-600 hover:underline">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    // ✅ Delete bot
    async function deleteBot(name) {
      const res = await fetch('/api/delete-bot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ appName: name, username: 'admin' })
      });
      const data = await res.json();
      Swal.fire(data.status ? "Deleted" : "Error", data.message, data.status ? "success" : "error");
      if (data.status) loadBots();
    }

    // ✅ Load all users
    async function loadUsers() {
      const res = await fetch('/api/admin/all-users');
      const users = await res.json();
      const container = document.getElementById('usersList');
      container.innerHTML = '';

      users.forEach(u => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow border-l-4 border-purple-400';
        div.innerHTML = `<strong>${u.username}</strong> | ${u.email} | Coins: <span class="text-purple-600 font-semibold">${u.coins}</span>`;
        container.appendChild(div);
      });
    }

    // ✅ Load all non-core files
    async function loadFiles() {
      const res = await fetch('/api/admin/files');
      const files = await res.json();
      const container = document.getElementById('filesList');
      container.innerHTML = '';

      files.forEach(file => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow flex justify-between items-center';
        div.innerHTML = `
          <span class="text-gray-700">${file}</span>
          <button onclick="deleteFile('${file}')" class="text-red-600 hover:underline">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    // ✅ Delete a file
    async function deleteFile(fileName) {
      const res = await fetch('/api/admin/delete-file', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: fileName })
      });
      const data = await res.json();
      Swal.fire(data.status ? "Deleted" : "Error", data.message, data.status ? "success" : "error");
      if (data.status) loadFiles();
    }
  </script>
</body>
</html>