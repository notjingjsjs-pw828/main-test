<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - BEN-BOT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 text-white h-screen p-4">
      <h2 class="text-xl font-bold mb-6">Admin Panel</h2>
      <nav class="space-y-2">
        <button onclick="showView('coinsView')" class="w-full text-left px-4 py-2 bg-gray-700 rounded">Add Coins</button>
        <button onclick="showView('botsView')" class="w-full text-left px-4 py-2 bg-gray-700 rounded">All Bots</button>
        <button onclick="showView('usersView')" class="w-full text-left px-4 py-2 bg-gray-700 rounded">All Users</button>
        <button onclick="showView('filesView')" class="w-full text-left px-4 py-2 bg-gray-700 rounded">Manage Files</button>
      </nav>
    </aside>

    <!-- Content Area -->
    <main class="flex-1 p-8">
      <!-- Add Coins -->
      <section id="coinsView" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Add Coins to User</h2>
        <input id="coinUser" type="text" placeholder="Username" class="border px-4 py-2 rounded mb-2 w-full" />
        <input id="coinAmount" type="number" placeholder="Amount" class="border px-4 py-2 rounded mb-4 w-full" />
        <button onclick="addCoins()" class="bg-green-500 text-white px-4 py-2 rounded">Add Coins</button>
      </section>

      <!-- All Bots -->
      <section id="botsView" class="hidden">
        <h2 class="text-2xl font-bold mb-4">All Bots</h2>
        <div id="botsList" class="space-y-2"></div>
      </section>

      <!-- All Users -->
      <section id="usersView" class="hidden">
        <h2 class="text-2xl font-bold mb-4">All Users</h2>
        <div id="usersList" class="space-y-2"></div>
      </section>

      <!-- Manage Files -->
      <section id="filesView" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Manage Files</h2>
        <div id="filesList" class="space-y-2"></div>
      </section>
    </main>
  </div>

  <script>
    function showView(viewId) {
      ['coinsView', 'botsView', 'usersView', 'filesView'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(viewId).classList.remove('hidden');

      if (viewId === 'botsView') loadBots();
      if (viewId === 'usersView') loadUsers();
      if (viewId === 'filesView') loadFiles();
    }

    async function addCoins() {
      const username = document.getElementById('coinUser').value.trim();
      const amount = parseInt(document.getElementById('coinAmount').value.trim());

      if (!username || isNaN(amount)) {
        return Swal.fire("Error", "Enter valid username and amount", "error");
      }

      const res = await fetch('/api/admin/add-coins', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, amount })
      });
      const data = await res.json();
      if (data.status) {
        Swal.fire("✅ Success", data.message, "success");
      } else {
        Swal.fire("❌ Error", data.message, "error");
      }
    }

    async function loadBots() {
      const res = await fetch('/api/admin/all-bots');
      const bots = await res.json();
      const container = document.getElementById('botsList');
      container.innerHTML = '';

      bots.forEach(bot => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow flex justify-between items-center';
        div.innerHTML = `
          <div>
            <strong>${bot.name}</strong> by <span class="text-blue-500">${bot.byUser}</span>
          </div>
          <button onclick="deleteBot('${bot.name}')" class="text-red-500">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    async function deleteBot(name) {
      const res = await fetch('/api/delete-bot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ appName: name, username: 'admin' })
      });
      const data = await res.json();
      if (data.status) {
        Swal.fire("Deleted", "Bot removed", "success");
        loadBots();
      } else {
        Swal.fire("Error", data.message, "error");
      }
    }

    async function loadUsers() {
      const res = await fetch('/api/admin/all-users');
      const users = await res.json();
      const container = document.getElementById('usersList');
      container.innerHTML = '';

      users.forEach(u => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow';
        div.innerHTML = `<strong>${u.username}</strong> | ${u.email} | Coins: ${u.coins}`;
        container.appendChild(div);
      });
    }

    async function loadFiles() {
      const res = await fetch('/api/admin/files');
      const files = await res.json();
      const container = document.getElementById('filesList');
      container.innerHTML = '';

      files.forEach(file => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded shadow flex justify-between items-center';
        div.innerHTML = `
          <span>${file}</span>
          <button onclick="deleteFile('${file}')" class="text-red-500">Delete</button>
        `;
        container.appendChild(div);
      });
    }

    async function deleteFile(fileName) {
      const res = await fetch('/api/admin/delete-file', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: fileName })
      });
      const data = await res.json();
      if (data.status) {
        Swal.fire("Deleted", "File removed", "success");
        loadFiles();
      } else {
        Swal.fire("Error", data.message, "error");
      }
    }
  </script>
</body>
</html>